@using System.ComponentModel
@*@using System.Web.Script.Serialization*@
@model Coevery.Projections.ViewModels.ProjectionEditViewModel
<section>
    <section>
        <div id="page-actions">
            <h1 class="pull-left">View Detail <span>show view detail information</span></h1>
        </div>
    </section>
    @{
        var sortedBy = new BindingList<SelectListItem>();
        Model.AllFields.ToList().ForEach(c =>
        {
            sortedBy.Add(new SelectListItem { Selected = (c.Name == Model.SortedBy), Text = c.Name });
        });

        var sortMode = new BindingList<SelectListItem>();
        sortMode.Add(new SelectListItem { Selected = Model.SortMode == "Desc", Text = "Desc" });
        sortMode.Add(new SelectListItem { Selected = Model.SortMode == "Asc", Text = "Asc" });

        var VisableTo = new BindingList<SelectListItem>();
        VisableTo.Add(new SelectListItem { Selected = Model.VisableTo == "All", Text = "All" });
        VisableTo.Add(new SelectListItem { Selected = Model.VisableTo == "Me", Text = "Me" });
    }
    <section id="main-content">
        <header id="page-title" class="clearfix">
            <btn-actions>
                <button class="btn btn-small" data-ng-click="exit()">Back</button>
                <button class="btn btn-primary btn-small" data-ng-click="save()">Save</button>
                <button class="btn btn-primary btn-small" data-ng-click="saveAndBack()">Save & Back</button>
            </btn-actions>
            <div class="min-height">
            </div>
        </header>
        @using (Html.BeginFormAntiForgeryPost(Url.Action("Edit", new { Id = Model.Id, EntityName = Model.Name, ReturnUrl = Request.QueryString["ReturnUrl"] }),
                                                  FormMethod.Post,
                                                  new { @class = "form-horizontal", @name = "myForm", @ng_submit = "save()" }))
        {
                
            <div class="row-fluid">
                <div class=" form-container form-fontstyle">
                    <div class="form-horizontal no-border">
                        <fieldset>
                            <legend>
                                <h5>General Info</h5>
                            </legend>

                            <section class="control-group">
                                <div class="span6">
                                    <label class="control-label">Name</label>
                                    <div class="controls">
                                        @Html.TextBoxFor(m => m.Name, new { @class = "span12", @disabled = "disabled" })
                                    </div>
                                </div>
                                <div class="span6">
                                    <label class="control-label">DisplayName</label>
                                    <div class="controls">
                                        @Html.TextBoxFor(m => m.DisplayName, new { @class = "span12" })
                                    </div>
                                </div>
                            </section>


                            <section class="control-group">
                                <div class="span6">
                                    <label class="control-label">VisableTo</label>
                                    <div class="controls">
                                        @Html.DropDownListFor(m => m.VisableTo, VisableTo, string.Empty, new { @class = "span12", @id = "visableto" })
                                    </div>
                                </div>
                                <div class="span6">
                                    <label class="control-label">PageRowCount</label>
                                    <div class="controls">
                                        @Html.TextBoxFor(m => m.PageRowCount, new { @type = "number", @class = "span12" })
                                    </div>
                                </div>
                            </section>
                        </fieldset>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12 form-container form-fontstyle">
                    <div class="form-horizontal no-border">
                        <fieldset>
                            <legend>
                                <h5>Select Fields to Display</h5>
                            </legend>
                            <div class="row-fluid">
                                <div class="span12">
                                    <div class="span6">
                                        <div class="viewfields-widget">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th>Fields</th>
                                                        <th class="rightCell">
                                                            <button class="btn-link" ng-click="AddAll()" type="button">Add All</button></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var oneField in Model.AllFields)
                                                    {
                                                        string fieldName = oneField.Name;
                                                        <tr>
                                                            <td name="unselectedField">@fieldName</td>
                                                            <td class="rightCell">
                                                                <span  ng-class="LabelClass('@fieldName')">Added</span>
                                                                <span  ng-style="ButtonStyle('@fieldName')" class=""style="line-height: 14px;">
                                                                    <button class="btn-link" ng-click="addfield('@fieldName')" type="button" style="line-height: 14px;">Add</button>
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <div class="span6">
                                        <div class="viewfields-widget">
                                            <h5>Drag and drop to reorder</h5>
                                            <input id="picklist" name="picklist" type="hidden" />
                                            <div class="sortable-list">
                                                <ul id="sortable">
                                                    <li ng-repeat="selectedColumn in SelectedColumns" style=""><span style="margin-left: 3px;">{{selectedColumn.FieldName}}</span>
                                                        <div class="pull-right">
                                                            <button class="btn-link" type="button" ng-click="removefield($index)">Remove</button>
                                                        </div>
                                                    </li>

                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row-fluid">
                                <div class="span12 sortedbyspan">
                                    <div class="span8">
                                        <label class="control-label " for="sortby">Sorted By</label>
                                        <div class="controls" style="margin-left: 10px;">
                                            @Html.DropDownListFor(m => m.SortedBy, sortedBy, string.Empty, new { @class = "span4", @id = "sortby" })
                                            @Html.DropDownListFor(m => m.SortMode, sortMode, string.Empty, new { @class = "span4", @id = "sortmode" })
                                            <input type="button" class="btn" name="Preview" value="Preview" ng-click="preview()" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        }
        <div class="row-fluid">
            <section class="gridStyle" data-ng-grid="gridOptions"></section>
        </div>
    </section>
</section>
<script>
    $(function () {
        $("#main-content").css("margin-top", $("#page-actions").outerHeight(true));
        $("#page-actions h1 span").attr("title", $("#page-actions h1 span").html());
        $('.sortable-list ul').sortable({
            placeholder: 'placeholder',
            forcePlaceholderSize: true
        });
    });
</script>

